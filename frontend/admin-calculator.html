<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Calculator - SDL Internal Pricing Tool</title>
    <script>
        const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) ||
                      (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);
        if (isIOS) {
            document.documentElement.classList.add('ios-device');
        }
    </script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background: #f5f5f5;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        @supports (-webkit-touch-callout: none) {
            body {
                overscroll-behavior-y: contain;
                -webkit-overflow-scrolling: touch;
                padding-bottom: 100px;
            }
        }

        @media screen and (max-width: 768px) {
            html.ios-device body {
                overscroll-behavior-y: contain;
                -webkit-overflow-scrolling: touch;
                padding-bottom: 100px;
            }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .page-title {
            background: linear-gradient(135deg, #2e7d32 0%, #1b5e20 100%);
            color: white;
            padding: 30px;
            text-align: center;
            font-size: 32px;
            font-weight: 700;
            text-shadow: 0 2px 10px rgba(0,0,0,0.2);
            letter-spacing: 1px;
        }

        .content {
            padding: 40px;
        }

        .section {
            margin-bottom: 40px;
            padding: 30px;
            background: #f8f9fa;
            border-radius: 15px;
            border-left: 5px solid #2e7d32;
        }

        .section h2 {
            color: #2e7d32;
            margin-top: 0;
            font-size: 1.5em;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
            box-sizing: border-box;
        }

        .form-group input:focus, .form-group textarea:focus {
            outline: none;
            border-color: #2e7d32;
        }

        .btn {
            background: linear-gradient(135deg, #2e7d32 0%, #1b5e20 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(46, 125, 50, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
        }

        .btn-export {
            background: linear-gradient(135deg, #4caf50 0%, #388e3c 100%);
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 14px;
            border-radius: 15px;
        }

        .product-analysis {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            border: 1px solid #e0e0e0;
        }

        .product-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #2e7d32;
        }

        .product-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .product-name {
            font-weight: 600;
            color: #333;
            font-size: 16px;
            flex: 1;
            margin-right: 20px;
        }

        .product-retailer {
            background: #2e7d32;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .boxes-section {
            background: #fff3e0;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #ff9800;
        }

        .boxes-section h4 {
            margin-top: 0;
            color: #e65100;
            font-size: 14px;
        }

        .box-item {
            background: white;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            position: relative;
        }

        .box-dimensions {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 10px;
        }

        .dimension-input {
            display: flex;
            flex-direction: column;
        }

        .dimension-input label {
            font-size: 11px;
            color: #666;
            margin-bottom: 3px;
            font-weight: 600;
        }

        .dimension-input input {
            padding: 6px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 13px;
        }

        .btn-remove-box {
            position: absolute;
            top: 8px;
            right: 8px;
            background: #f44336;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            cursor: pointer;
            font-weight: 600;
        }

        .btn-add-box {
            background: #ff9800;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 15px;
            font-size: 13px;
            cursor: pointer;
            font-weight: 600;
            margin-top: 5px;
        }

        .btn-add-box:hover {
            background: #f57c00;
        }

        .price-input-section {
            margin: 15px 0;
        }

        .price-input-section label {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
            display: block;
            font-weight: 600;
        }

        .price-input-section input {
            width: 200px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .calculations {
            background: #e8f5e9;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .calc-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .calc-row.total {
            font-weight: 700;
            font-size: 18px;
            border-top: 2px solid #4caf50;
            padding-top: 12px;
            margin-top: 12px;
            color: #1b5e20;
        }

        .calc-row.landed {
            font-weight: 600;
            font-size: 15px;
            padding: 8px 0;
            background: #c8e6c9;
            padding: 8px;
            border-radius: 4px;
            margin: 8px 0;
        }

        .calc-row.margin-tier {
            font-size: 13px;
            font-style: italic;
            color: #666;
        }

        .margin-editor {
            background: #fff9e6;
            padding: 12px;
            border-radius: 6px;
            margin: 15px 0;
            border-left: 4px solid #ffc107;
        }

        .margin-editor label {
            font-size: 12px;
            font-weight: 600;
            color: #f57c00;
            display: block;
            margin-bottom: 5px;
        }

        .margin-editor input {
            width: 120px;
            padding: 8px;
            border: 2px solid #ffc107;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 600;
        }

        .margin-editor small {
            display: block;
            margin-top: 5px;
            font-size: 11px;
            color: #666;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .error {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #f44336;
        }

        .success {
            background: #e8f5e9;
            color: #2e7d32;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #4caf50;
        }

        .collection-tag {
            display: inline-block;
            background: #e3f2fd;
            color: #1976d2;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            margin: 4px 2px;
        }

        .collection-tag.uncertain {
            background: #fff3e0;
            color: #f57c00;
            border: 2px dashed #ff9800;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }

            .content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="page-title">🏛️ ADMIN CALCULATOR</div>

        <div class="content">
            <!-- Product URL Input -->
            <div class="section">
                <h2>📦 Paste Product Links</h2>
                <div class="form-group">
                    <label for="productUrls">Product URLs (one per line):</label>
                    <textarea id="productUrls" rows="8" placeholder="https://www.amazon.com/product-link&#10;https://www.wayfair.com/product-link&#10;https://www.target.com/product-link&#10;&#10;Paste your product URLs here..."></textarea>
                </div>

                <button class="btn" onclick="analyzeProducts()">🔍 Scrape & Analyze</button>
                <button class="btn btn-secondary" onclick="clearAnalysis()">🗑️ Clear All</button>

                <div id="analysisResult"></div>
            </div>
        </div>
    </div>

    <script>
        let products = [];

        // Dynamic margin tiers based on landed cost
        function getMarginPercent(landedCost) {
            if (landedCost < 200) return 57.5; // Average of 55-60%
            if (landedCost < 500) return 50;
            if (landedCost < 1000) return 45;
            if (landedCost < 2500) return 40;
            return 38;
        }

        function getMarginTierLabel(landedCost) {
            if (landedCost < 200) return 'Under $200: 55-60% margin';
            if (landedCost < 500) return '$200-$499: 50% margin';
            if (landedCost < 1000) return '$500-$999: 45% margin';
            if (landedCost < 2500) return '$1,000-$2,499: 40% margin';
            return 'Over $2,500: 38% margin';
        }

        // Round up to nearest $5
        function roundToNearest5(price) {
            return Math.ceil(price / 5) * 5;
        }

        // Categorize product for Shopify collections
        function categorizeProduct(product) {
            const name = (product.name || '').toLowerCase();
            const category = (product.category || '').toLowerCase();
            const combined = name + ' ' + category;

            const collections = [];
            let uncertain = false;

            // Furniture categories
            if (combined.match(/sofa|couch|sectional|loveseat/)) {
                collections.push('Sofas & Sectionals');
            } else if (combined.match(/chair|armchair|accent chair|dining chair|recliner/)) {
                collections.push('Chairs & Seating');
            } else if (combined.match(/table|coffee table|end table|side table|console table|dining table/)) {
                collections.push('Tables');
            } else if (combined.match(/bed|mattress|headboard|bedframe/)) {
                collections.push('Bedroom');
            } else if (combined.match(/dresser|nightstand|armoire|wardrobe|chest/)) {
                collections.push('Bedroom');
            } else if (combined.match(/desk|office|bookshelf|bookcase/)) {
                collections.push('Office Furniture');
            } else if (combined.match(/rug|carpet|mat/)) {
                collections.push('Rugs');
            } else if (combined.match(/lamp|lighting|chandelier|sconce/)) {
                collections.push('Lighting');
            } else if (combined.match(/decor|decorative|wall art|mirror|vase|sculpture/)) {
                collections.push('Home Decor');
            } else if (combined.match(/outdoor|patio|garden/)) {
                collections.push('Outdoor');
            } else {
                collections.push('Uncategorized');
                uncertain = true;
            }

            return { collections, uncertain };
        }

        async function analyzeProducts() {
            const urls = document.getElementById('productUrls').value.trim();
            if (!urls) {
                alert('Please enter at least one product URL');
                return;
            }

            const urlList = urls.split('\n').filter(url => url.trim());
            const resultDiv = document.getElementById('analysisResult');

            resultDiv.innerHTML = '<div class="loading">🔄 Scraping products... This may take a moment...</div>';

            try {
                const response = await fetch('/api/scrape', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ urls: urlList })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                products = (data.products || []).map(p => {
                    // Initialize with scraped dimensions or defaults
                    const dims = p.dimensions || { length: 24, width: 18, height: 12 };
                    return {
                        ...p,
                        boxes: [{
                            length: dims.length || 24,
                            width: dims.width || 18,
                            height: dims.height || 12
                        }]
                    };
                });

                displayProductAnalysis();

            } catch (error) {
                console.error('Error analyzing products:', error);
                resultDiv.innerHTML = `<div class="error">❌ Error: ${error.message}</div>`;
            }
        }

        function displayProductAnalysis() {
            const container = document.getElementById('analysisResult');

            if (!products || products.length === 0) {
                container.innerHTML = '<div class="error">No products found</div>';
                return;
            }

            let html = '<div style="margin: 20px 0;"><button class="btn btn-export" onclick="exportToShopifyCSV()">📥 Download Shopify CSV</button></div>';
            html += '<div class="product-analysis">';

            products.forEach((product, index) => {
                const { collections, uncertain } = categorizeProduct(product);
                const collectionTags = collections.map(c =>
                    `<span class="collection-tag ${uncertain ? 'uncertain' : ''}">${c}</span>`
                ).join('');

                html += `
                    <div class="product-item" data-index="${index}">
                        <div class="product-header">
                            <div class="product-name">${product.name || 'Unnamed Product'}</div>
                            <div class="product-retailer">${product.retailer || 'Unknown'}</div>
                        </div>

                        <div style="margin-bottom: 10px;">
                            <strong>Collections:</strong> ${collectionTags}
                        </div>

                        <div class="price-input-section">
                            <label>Product Price ($)</label>
                            <input type="number" value="${product.price || 0}" step="0.01" min="0"
                                   onchange="updatePrice(${index}, this.value)">
                        </div>

                        <div class="boxes-section">
                            <h4>📦 Shipping Boxes (Add multiple if item ships in multiple boxes)</h4>
                            <div id="boxes-${index}"></div>
                            <button class="btn-add-box" onclick="addBox(${index})">+ Add Box</button>
                        </div>

                        <div class="margin-editor">
                            <label>✏️ Profit Margin (%)</label>
                            <input type="number" id="margin-${index}" value="" step="0.5" min="0" max="100"
                                   onchange="updateMargin(${index}, this.value)">
                            <small id="margin-suggestion-${index}"></small>
                        </div>

                        <div class="calculations" id="calc-${index}"></div>
                    </div>
                `;
            });

            html += '</div>';
            container.innerHTML = html;

            // Render boxes and calculate
            products.forEach((product, index) => {
                renderBoxes(index);
                calculateProduct(index);
            });
        }

        function renderBoxes(productIndex) {
            const product = products[productIndex];
            const container = document.getElementById(`boxes-${productIndex}`);

            let html = '';
            product.boxes.forEach((box, boxIndex) => {
                html += `
                    <div class="box-item">
                        ${product.boxes.length > 1 ? `<button class="btn-remove-box" onclick="removeBox(${productIndex}, ${boxIndex})">✕</button>` : ''}
                        <div style="font-weight: 600; font-size: 12px; margin-bottom: 8px;">Box ${boxIndex + 1}</div>
                        <div class="box-dimensions">
                            <div class="dimension-input">
                                <label>Length (in)</label>
                                <input type="number" value="${box.length}" step="0.1" min="0"
                                       onchange="updateBoxDimension(${productIndex}, ${boxIndex}, 'length', this.value)">
                            </div>
                            <div class="dimension-input">
                                <label>Width (in)</label>
                                <input type="number" value="${box.width}" step="0.1" min="0"
                                       onchange="updateBoxDimension(${productIndex}, ${boxIndex}, 'width', this.value)">
                            </div>
                            <div class="dimension-input">
                                <label>Height (in)</label>
                                <input type="number" value="${box.height}" step="0.1" min="0"
                                       onchange="updateBoxDimension(${productIndex}, ${boxIndex}, 'height', this.value)">
                            </div>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function addBox(productIndex) {
            products[productIndex].boxes.push({ length: 24, width: 18, height: 12 });
            renderBoxes(productIndex);
            calculateProduct(productIndex);
        }

        function removeBox(productIndex, boxIndex) {
            if (products[productIndex].boxes.length > 1) {
                products[productIndex].boxes.splice(boxIndex, 1);
                renderBoxes(productIndex);
                calculateProduct(productIndex);
            }
        }

        function updateBoxDimension(productIndex, boxIndex, dimension, value) {
            products[productIndex].boxes[boxIndex][dimension] = parseFloat(value) || 0;
            calculateProduct(productIndex);
        }

        function updatePrice(index, value) {
            products[index].price = parseFloat(value) || 0;
            calculateProduct(index);
        }

        function updateMargin(index, value) {
            const marginValue = parseFloat(value);
            if (marginValue > 0) {
                products[index].customMargin = marginValue;
            } else {
                delete products[index].customMargin;
            }
            calculateProduct(index);
        }

        function calculateProduct(index) {
            const product = products[index];
            const price = product.price || 0;

            // Calculate total cubic feet from all boxes
            let totalCubicFeet = 0;
            product.boxes.forEach(box => {
                const cubicInches = box.length * box.width * box.height;
                totalCubicFeet += cubicInches / 1728;
            });

            // Freight calculation (simplified - $8.50 per cubic foot, $30 minimum)
            const freightCost = Math.max(30, totalCubicFeet * 8.5);

            // Duty calculation (25% of item price)
            const dutyAmount = price * 0.25;

            // Wharfage (1.5% of item price)
            const wharfage = price * 0.015;

            // Total landed cost
            const landedCost = price + freightCost + dutyAmount + wharfage;

            // Determine margin to use (custom or dynamic)
            const suggestedMargin = getMarginPercent(landedCost);
            const marginPercent = product.customMargin !== undefined ? product.customMargin : suggestedMargin;
            const marginAmount = landedCost * (marginPercent / 100);

            // Update margin input and suggestion
            const marginInput = document.getElementById(`margin-${index}`);
            const marginSuggestion = document.getElementById(`margin-suggestion-${index}`);
            if (marginInput && !marginInput.value) {
                marginInput.value = suggestedMargin.toFixed(1);
            }
            if (marginSuggestion) {
                if (product.customMargin !== undefined) {
                    marginSuggestion.textContent = `Suggested: ${suggestedMargin.toFixed(1)}% (${getMarginTierLabel(landedCost)})`;
                } else {
                    marginSuggestion.textContent = `Auto: ${getMarginTierLabel(landedCost)}`;
                }
            }

            // MSRP before rounding
            const msrpBeforeRounding = landedCost + marginAmount;

            // Round up to nearest $5
            const msrp = roundToNearest5(msrpBeforeRounding);

            // Store calculated values
            product.calculated = {
                totalCubicFeet,
                freightCost,
                dutyAmount,
                wharfage,
                landedCost,
                marginPercent,
                marginAmount,
                msrpBeforeRounding,
                msrp
            };

            // Display calculations
            const calcDiv = document.getElementById(`calc-${index}`);
            const isCustomMargin = product.customMargin !== undefined;
            calcDiv.innerHTML = `
                <div class="calc-row">
                    <span>Total Cubic Feet (${product.boxes.length} box${product.boxes.length > 1 ? 'es' : ''}):</span>
                    <span>${totalCubicFeet.toFixed(3)} ft³</span>
                </div>
                <div class="calc-row">
                    <span>Product Price:</span>
                    <span>$${price.toFixed(2)}</span>
                </div>
                <div class="calc-row">
                    <span>Freight Cost:</span>
                    <span>$${freightCost.toFixed(2)}</span>
                </div>
                <div class="calc-row">
                    <span>Duty (25%):</span>
                    <span>$${dutyAmount.toFixed(2)}</span>
                </div>
                <div class="calc-row">
                    <span>Wharfage (1.5%):</span>
                    <span>$${wharfage.toFixed(2)}</span>
                </div>
                <div class="calc-row landed">
                    <span>Total Landed Cost:</span>
                    <span>$${landedCost.toFixed(2)}</span>
                </div>
                <div class="calc-row">
                    <span>Profit Margin (${marginPercent.toFixed(1)}%)${isCustomMargin ? ' 📝' : ' ✨'}:</span>
                    <span>$${marginAmount.toFixed(2)}</span>
                </div>
                <div class="calc-row">
                    <span>MSRP (before rounding):</span>
                    <span>$${msrpBeforeRounding.toFixed(2)}</span>
                </div>
                <div class="calc-row total">
                    <span>FINAL MSRP (rounded to $5):</span>
                    <span>$${msrp.toFixed(2)}</span>
                </div>
            `;
        }

        function exportToShopifyCSV() {
            if (!products || products.length === 0) {
                alert('No products to export');
                return;
            }

            // Shopify CSV headers
            const headers = [
                'Handle', 'Title', 'Body (HTML)', 'Vendor', 'Type',
                'Tags', 'Published', 'Option1 Name', 'Option1 Value',
                'Variant SKU', 'Variant Grams', 'Variant Inventory Tracker',
                'Variant Inventory Policy', 'Variant Fulfillment Service',
                'Variant Price', 'Variant Compare At Price', 'Variant Requires Shipping',
                'Variant Taxable', 'Variant Barcode', 'Image Src', 'Image Position',
                'Image Alt Text', 'Gift Card', 'SEO Title', 'SEO Description',
                'Google Shopping / Google Product Category', 'Google Shopping / Gender',
                'Google Shopping / Age Group', 'Google Shopping / MPN',
                'Google Shopping / AdWords Grouping', 'Google Shopping / AdWords Labels',
                'Google Shopping / Condition', 'Google Shopping / Custom Product',
                'Google Shopping / Custom Label 0', 'Google Shopping / Custom Label 1',
                'Google Shopping / Custom Label 2', 'Google Shopping / Custom Label 3',
                'Google Shopping / Custom Label 4', 'Variant Image', 'Variant Weight Unit',
                'Variant Tax Code', 'Cost per item', 'Status', 'Collection'
            ];

            const rows = [headers];

            products.forEach(product => {
                const calc = product.calculated || {};
                const { collections, uncertain } = categorizeProduct(product);
                const collectionStr = uncertain ? `⚠️ ${collections.join(', ')}` : collections.join(', ');

                // Create handle from title
                const handle = (product.name || 'product')
                    .toLowerCase()
                    .replace(/[^a-z0-9]+/g, '-')
                    .replace(/^-|-$/g, '');

                const row = [
                    handle, // Handle
                    product.name || 'Unnamed Product', // Title
                    product.description || '', // Body (HTML)
                    product.retailer || 'SDL', // Vendor
                    'Furniture', // Type
                    '', // Tags
                    'TRUE', // Published
                    'Title', // Option1 Name
                    'Default Title', // Option1 Value
                    product.sku || '', // Variant SKU
                    '', // Variant Grams
                    'shopify', // Variant Inventory Tracker
                    'deny', // Variant Inventory Policy
                    'manual', // Variant Fulfillment Service
                    calc.msrp || 0, // Variant Price
                    '', // Variant Compare At Price
                    'TRUE', // Variant Requires Shipping
                    'TRUE', // Variant Taxable
                    '', // Variant Barcode
                    product.image || '', // Image Src
                    '1', // Image Position
                    '', // Image Alt Text
                    'FALSE', // Gift Card
                    product.name || '', // SEO Title
                    '', // SEO Description
                    'Furniture', // Google Shopping / Google Product Category
                    '', // Google Shopping / Gender
                    '', // Google Shopping / Age Group
                    '', // Google Shopping / MPN
                    '', // Google Shopping / AdWords Grouping
                    '', // Google Shopping / AdWords Labels
                    'new', // Google Shopping / Condition
                    'FALSE', // Google Shopping / Custom Product
                    '', '', '', '', '', // Custom Labels 0-4
                    '', // Variant Image
                    'kg', // Variant Weight Unit
                    '', // Variant Tax Code
                    calc.landedCost || 0, // Cost per item
                    'active', // Status
                    collectionStr // Collection
                ];

                rows.push(row);
            });

            // Convert to CSV
            const csvContent = rows.map(row =>
                row.map(cell => {
                    const str = String(cell || '');
                    // Escape quotes and wrap in quotes if contains comma or quote
                    if (str.includes(',') || str.includes('"') || str.includes('\n')) {
                        return '"' + str.replace(/"/g, '""') + '"';
                    }
                    return str;
                }).join(',')
            ).join('\n');

            // Download
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `shopify-products-${Date.now()}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function clearAnalysis() {
            products = [];
            document.getElementById('productUrls').value = '';
            document.getElementById('analysisResult').innerHTML = '';
        }
    </script>
</body>
</html>
