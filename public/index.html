<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>SDL — Shopify Product Import</title>
<style>
:root { --green:#1ea463; }
body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; max-width: 1200px; margin: 24px auto; padding: 0 16px; }
h1 { color: var(--green); }
textarea { width: 100%; min-height: 160px; }
.row { margin: 12px 0; }
.grid { display: grid; gap: 12px; grid-template-columns: 1fr 1fr; }
table { width: 100%; border-collapse: collapse; font-size: 14px; }
th, td { border: 1px solid #ddd; padding: 6px 8px; vertical-align: top; }
th { background: #f7f7f7; text-align: left; position: sticky; top: 0; z-index: 1; }
.btn { background: var(--green); color: #fff; padding: 10px 14px; border: 0; border-radius: 8px; cursor: pointer; }
.btn.secondary { background: #333; }
.hint { color: #666; font-size: 13px; }
input[type="number"] { width: 90px; }
.nowrap { white-space: nowrap; }
.img { width: 80px; height: 80px; object-fit: cover; border: 1px solid #ddd; border-radius: 6px; }
.tag { display: inline-block; padding: 2px 6px; margin: 2px; background: #eef8f2; border: 1px solid #bbe4cf; border-radius: 12px; font-size: 12px; }
.flex { display: flex; gap: 12px; align-items: center; }
.boxrow input[type="number"] { width: 80px; }
.linklike { color: var(--green); cursor: pointer; text-decoration: underline; }
details { margin: 6px 0; }
summary { cursor: pointer; }
</style>
</head>
<body>
<h1>SDL — Shopify Product Import</h1>
<p class="hint">Paste one URL per line (Amazon, Luna, generic). Default margin <b>45%</b>. Retail is rounded <b>up</b> to the nearest $5. Edit per row: <b>Cost</b>, <b>Margin</b>, and add <b>multiple box dimensions</b>.</p>
<div class="row grid">
<div>
<label>Product URLs</label>
<textarea id="links" placeholder="https://www.amazon.com/...&#10;https://lunafurniture.com/..."></textarea>
<div class="hint">Primary: <b>Zyte</b> • Backup: <b>ChatGPT parsing</b></div>
</div>
<div>
<label>Default Margin (%)</label>
<div class="flex">
<input id="margin" type="number" value="45" min="0" max="95" step="1" />
<span class="hint">Used unless overridden per row.</span>
</div>
<details>
<summary>Shopify collections (optional)</summary>
<div class="hint">If server has Shopify creds configured, it will auto-suggest collections.</div>
</details>
</div>
</div>
<div class="row flex">
<button class="btn" id="preview">Preview</button>
<button class="btn secondary" id="download">Export CSV</button>
<div id="msg" class="hint"></div>
</div>
<div id="results"></div>
<script>
function urlsFromTextarea(){ const raw=document.getElementById('links').value.trim(); return raw.split(/[\r\n]+/).map(s=>s.trim()).filter(Boolean); }
function h(tag, attrs={}, kids=[]){ const el=document.createElement(tag); for(const k in attrs){ if(k==='class') el.className=attrs[k]; else if(k==='html') el.innerHTML=attrs[k]; else el.setAttribute(k, attrs[k]); } kids.forEach(c=>{ if(typeof c==='string') el.appendChild(document.createTextNode(c)); else if(c) el.appendChild(c); }); return el; }
let lastPreview = [];
async function doPreview(){ const urls = urlsFromTextarea(); if(!urls.length){ document.getElementById('msg').textContent='Please paste at least one URL.'; return; } const marginPercent = Number(document.getElementById('margin').value || 45); document.getElementById('msg').textContent='Scraping and computing…'; const r = await fetch('/api/preview',{ method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ urls, marginPercent }) }); document.getElementById('msg').textContent=''; const j = await r.json(); lastPreview = j.items || []; renderTable(lastPreview); }
function renderTable(items){ const wrap = document.getElementById('results'); wrap.innerHTML=''; if(!items || !items.length) return; const table = h('table'); const thead = h('thead'); const head = h('tr'); ['Image','Title','Vendor','Cost','Margin %','Retail ($5)','Boxes','Category','Collections (auto)','Tags','Handle','Source'].forEach(t=> head.appendChild(h('th',{html:t}))); thead.appendChild(head); table.appendChild(thead); const tbody = h('tbody'); items.forEach((it, idx)=>{ const tr = h('tr'); const img = it.image || (it.images && it.images[0]) || ''; tr.appendChild(h('td',{},[ img ? h('img',{src:img,class:'img'}) : '' ])); tr.appendChild(h('td',{html: it.title || ''})); tr.appendChild(h('td',{html: it.vendor || ''})); const costIn = h('input',{type:'number', value:String(it.cost||0), step:'1', min:'0'}); costIn.addEventListener('change', e=>{ lastPreview[idx].cost = Number(e.target.value||0); recomputeRetail(idx); }); tr.appendChild(h('td',{},[costIn])); const mIn = h('input',{type:'number', value:String(it.margin_percent||45), step:'1', min:'0', max:'95'}); mIn.addEventListener('change', e=>{ lastPreview[idx].margin_percent = Number(e.target.value||45); recomputeRetail(idx); }); tr.appendChild(h('td',{},[mIn])); const retail = h('div',{class:'nowrap', html:'$'+String(it.price_rounded||0)}); retail.dataset.role='retail'; tr.appendChild(h('td',{},[retail])); const boxWrap = h('div'); const list = h('div',{class:'boxlist'}); const addBtn = h('button',{class:'btn'},['+ add box']); addBtn.type='button'; function boxRow(bx, bIdx){ const row = h('div',{class:'boxrow flex'}); const l = h('input',{type:'number', step:'0.1', min:'0', value: String(bx.l||'')}); row.appendChild(h('span',{},['L'])); row.appendChild(l); const w = h('input',{type:'number', step:'0.1', min:'0', value: String(bx.w||'')}); row.appendChild(h('span',{},['W'])); row.appendChild(w); const hIn = h('input',{type:'number', step:'0.1', min:'0', value: String(bx.h||'')}); row.appendChild(h('span',{},['H'])); row.appendChild(hIn); const del = h('span',{class:'linklike'},['remove']); del.addEventListener('click', ()=>{ lastPreview[idx].boxes.splice(bIdx,1); renderBoxes(); }); row.appendChild(del); function commit(){ lastPreview[idx].boxes[bIdx] = { l: Number(l.value||0), w: Number(w.value||0), h: Number(hIn.value||0) }; } l.addEventListener('change', commit); w.addEventListener('change', commit); hIn.addEventListener('change', commit); return row; } function renderBoxes(){ list.innerHTML=''; (lastPreview[idx].boxes||[]).forEach((bx, bIdx)=> list.appendChild(boxRow(bx, bIdx))); } if(!Array.isArray(lastPreview[idx].boxes)) lastPreview[idx].boxes = []; addBtn.addEventListener('click', ()=>{ lastPreview[idx].boxes.push({ l:'', w:'', h:'' }); renderBoxes(); }); boxWrap.appendChild(list); boxWrap.appendChild(addBtn); const details = h('details',{},[ h('summary',{},['Edit boxes (L/W/H inches) — ', String((lastPreview[idx].boxes||[]).length), ' total']) ]); details.appendChild(boxWrap); tr.appendChild(h('td',{},[details])); const catIn = h('input',{type:'text', value: it.product_category || ''}); catIn.addEventListener('input', e=>{ lastPreview[idx].product_category = e.target.value; }); tr.appendChild(h('td',{},[catIn])); const coll = h('div',{}, (it.auto_collections||[]).map(c => h('span',{class:'tag'},[c]))); tr.appendChild(h('td',{},[coll])); const tagsIn = h('input',{type:'text', value:(it.tags||[]).join(', ')}); tagsIn.addEventListener('input', e=>{ lastPreview[idx].tags = e.target.value.split(',').map(s=>s.trim()).filter(Boolean); }); tr.appendChild(h('td',{},[tagsIn])); tr.appendChild(h('td',{html: it.handle || ''})); tr.appendChild(h('td',{},[ h('a',{href: it.source_url, target:'_blank'},['Open']) ])); tbody.appendChild(tr); }); table.appendChild(tbody); wrap.appendChild(table); function recomputeRetail(i){ const it = lastPreview[i]; const retail = Math.ceil((Number(it.cost||0)*(1+Number(it.margin_percent||45)/100))/5)*5; it.price_rounded = retail; wrap.querySelectorAll('div[data-role="retail"]')[i].textContent = '$'+String(retail); } }
async function exportCsv(){ const urls = urlsFromTextarea(); if(!urls.length){ document.getElementById('msg').textContent='Please paste at least one URL.'; return; } const overrides = {}; (lastPreview||[]).forEach(it=>{ overrides[it.handle] = { cost: it.cost, marginPercent: it.margin_percent, product_category: it.product_category, type: it.type || '', tags: it.tags || [], boxes: Array.isArray(it.boxes)? it.boxes : [] }; }); const marginPercent = Number(document.getElementById('margin').value || 45); document.getElementById('msg').textContent = 'Building CSV…'; const r = await fetch('/api/build-csv', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ urls, marginPercent, overrides }) }); if(!r.ok){ document.getElementById('msg').textContent='Error: '+(await r.text()); return; } const blob = await r.blob(); const a=document.createElement('a'); a.href = URL.createObjectURL(blob); a.download='sdl_shopify_import.csv'; document.body.appendChild(a); a.click(); a.remove(); document.getElementById('msg').textContent='CSV downloaded.'; }
document.getElementById('preview').addEventListener('click', doPreview);
document.getElementById('download').addEventListener('click', exportCsv);
</script>
</body>
</html>
